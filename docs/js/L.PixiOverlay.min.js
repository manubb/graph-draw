!function(i){if("function"==typeof define&&define.amd)define(["leaflet","pixi.js"],i);else if("undefined"!=typeof module)module.exports=i(require("leaflet"),require("pixi.js"));else{if(void 0===window.L)throw new Error("Leaflet must be loaded first");if(void 0===window.PIXI)throw new Error("Pixi.js must be loaded first");i(window.L,window.PIXI)}}(function(i,t){i.PixiOverlay=i.Layer.extend({options:{padding:.1,forceCanvas:!1,resolution:i.Browser.retina?2:1},initialize:function(t,e,n){i.setOptions(this,n),i.stamp(this),this._drawCallback=t,this._pixiContainer=e,this._rendererOptions={transparent:!0,resolution:this.options.resolution,antialias:!0,forceCanvas:this.options.forceCanvas}},onAdd:function(){if(!this._container){var e=this._container=document.createElement("div");i.DomUtil.addClass(this._container,"leaflet-pixi-overlay"),this._renderer=t.autoDetectRenderer(this._rendererOptions),e.appendChild(this._renderer.view),this._zoomAnimated&&i.DomUtil.addClass(e,"leaflet-zoom-animated")}this.getPane().appendChild(this._container);var n=this._map;this._initialZoom=n.getMaxZoom(),this._wgsOrigin=i.latLng([0,0]),this._disableLeafletRounding(),this._wgsInitialShift=n.project(this._wgsOrigin,this._initialZoom),this._enableLeafletRounding(),this._mapInitialZoom=n.getZoom(),this._scale=n.getZoomScale(this._mapInitialZoom,this._initialZoom);var o=this;this.utils={latLngToLayerPoint:function(t,e){return e=void 0===e?o._initialZoom:e,n.project(i.latLng(t),e)},layerPointToLatLng:function(t,e){e=void 0===e?o._initialZoom:e;var r=i.point(t);return n.unproject(r,e)},getScale:function(i){return void 0===i?o._scale:n.getZoomScale(i,o._initialZoom)},getRenderer:function(){return o._renderer},getContainer:function(){return o._pixiContainer},getMap:function(){return o._map}},this._update()},onRemove:function(){i.DomUtil.remove(this._container)},getEvents:function(){var i={zoom:this._onZoom,moveend:this._update,zoomend:this._zoomChange};return this._zoomAnimated&&(i.zoomanim=this._onAnimZoom),i},_onAnimZoom:function(i){this._updateTransform(i.center,i.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var n=this._map.getZoomScale(e,this._zoom),o=i.DomUtil.getPosition(this._container),r=this._map.getSize().multiplyBy(.5+this.options.padding),s=this._map.project(this._center,e),a=this._map.project(t,e).subtract(s),h=r.multiplyBy(-n).add(o).add(r).subtract(a);i.Browser.any3d?i.DomUtil.setTransform(this._container,h,n):i.DomUtil.setPosition(this._container,h)},_update:function(t){if(!this._map._animatingZoom||!this._bounds){var e=this.options.padding,n=this._map.getSize(),o=this._map.containerPointToLayerPoint(n.multiplyBy(-e)).round();this._bounds=new i.Bounds(o,o.add(n.multiplyBy(1+2*e)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom();var r=this._renderer.view,s=this._bounds,a=this._container,h=s.getSize();if(i.DomUtil.setPosition(a,s.min),!this._renderer.size||this._renderer.size.x!==h.x||this._renderer.size.y!==h.y){if(this._renderer.gl&&(this._renderer.resolution=this._renderer.rootRenderTarget.resolution=this.options.resolution),this._renderer.resize(h.x,h.y),r.style.width=h.x+"px",r.style.height=h.y+"px",this._renderer.gl){var d=this._renderer.gl;d.drawingBufferWidth!==this._renderer.width&&(this._renderer.resolution=this._renderer.rootRenderTarget.resolution=this.options.resolution*d.drawingBufferWidth/this._renderer.width,this._renderer.resize(h.x,h.y))}this._renderer.size=h}this._disableLeafletRounding();var l=this._map.latLngToLayerPoint(this._wgsOrigin)._subtract(this._wgsInitialShift.multiplyBy(this._scale))._subtract(s.min);this._pixiContainer.scale.set(this._scale),this._pixiContainer.position.set(l.x,l.y),this._drawCallback(this.utils),this._enableLeafletRounding()}},_disableLeafletRounding:function(){this._leaflet_round=i.Point.prototype._round,i.Point.prototype._round=function(){return this}},_enableLeafletRounding:function(){i.Point.prototype._round=this._leaflet_round},_zoomChange:function(){this._scale=this._map.getZoomScale(this._map.getZoom(),this._initialZoom)}}),i.pixiOverlay=function(t,e,n){return i.Browser.canvas?new i.PixiOverlay(t,e,n):null}});