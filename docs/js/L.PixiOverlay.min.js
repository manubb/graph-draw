!function(t){if("function"==typeof define&&define.amd)define(["leaflet","pixi.js"],t);else if("undefined"!=typeof module)module.exports=t(require("leaflet"),require("pixi.js"));else{if(void 0===window.L)throw new Error("Leaflet must be loaded first");if(void 0===window.PIXI)throw new Error("Pixi.js must be loaded first");t(window.L,window.PIXI)}}(function(_,r){var t=_.Point.prototype._round,i=function(){return this};function e(t,i,e){i?t.destroy():e||(t.autoPreventDefault=!1)}var n={options:{padding:.1,forceCanvas:!1,doubleBuffering:!1,resolution:_.Browser.retina?2:1,projectionZoom:function(t){return(t.getMaxZoom()+t.getMinZoom())/2},destroyInteractionManager:!1,autoPreventDefault:!0},initialize:function(t,i,e){_.setOptions(this,e),_.stamp(this),this._drawCallback=t,this._pixiContainer=i,this._rendererOptions={transparent:!0,resolution:this.options.resolution,antialias:!0,forceCanvas:this.options.forceCanvas},this._doubleBuffering=r.utils.isWebGLSupported()&&!this.options.forceCanvas&&this.options.doubleBuffering},_setMap:function(){},_setContainerStyle:function(){},_addContainer:function(){this.getPane().appendChild(this._container)},_setEvents:function(){},onAdd:function(t){if(this._setMap(t),!this._container){var i=this._container=_.DomUtil.create("div","leaflet-pixi-overlay");i.style.position="absolute",this._renderer=r.autoDetectRenderer(this._rendererOptions),e(this._renderer.plugins.interaction,this.options.destroyInteractionManager,this.options.autoPreventDefault),i.appendChild(this._renderer.view),this._zoomAnimated&&(_.DomUtil.addClass(i,"leaflet-zoom-animated"),this._setContainerStyle()),this._doubleBuffering&&(this._auxRenderer=r.autoDetectRenderer(this._rendererOptions),e(this._auxRenderer.plugins.interaction,this.options.destroyInteractionManager,this.options.autoPreventDefault),i.appendChild(this._auxRenderer.view),this._renderer.view.style.position="absolute",this._auxRenderer.view.style.position="absolute")}this._addContainer(),this._setEvents();var n=this._map;this._initialZoom=this.options.projectionZoom(n),this._wgsOrigin=_.latLng([0,0]),this._wgsInitialShift=n.project(this._wgsOrigin,this._initialZoom),this._mapInitialZoom=n.getZoom(),this._scale=n.getZoomScale(this._mapInitialZoom,this._initialZoom);var o=this;this.utils={latLngToLayerPoint:function(t,i){return i=void 0===i?o._initialZoom:i,n.project(_.latLng(t),i)},layerPointToLatLng:function(t,i){i=void 0===i?o._initialZoom:i;var e=_.point(t);return n.unproject(e,i)},getScale:function(t){return void 0===t?n.getZoomScale(n.getZoom(),o._initialZoom):n.getZoomScale(t,o._initialZoom)},getRenderer:function(){return o._renderer},getContainer:function(){return o._pixiContainer},getMap:function(){return o._map}},this._update({type:"add"})},onRemove:function(){_.DomUtil.remove(this._container)},getEvents:function(){var t={zoom:this._onZoom,moveend:this._update,zoomend:this._zoomChange};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(t){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,i){var e=this._map.getZoomScale(i,this._zoom),n=this._map.getSize().multiplyBy(.5+this.options.padding),o=this._map.project(this._center,i),r=n.multiplyBy(-e).add(o).subtract(this._map._getNewPixelOrigin(t,i));_.Browser.any3d?_.DomUtil.setTransform(this._container,r,e):_.DomUtil.setPosition(this._container,r)},_redraw:function(t,i){this._disableLeafletRounding();var e=this._map.latLngToLayerPoint(this._wgsOrigin)._subtract(this._wgsInitialShift.multiplyBy(this._scale))._subtract(t);this._pixiContainer.scale.set(this._scale),this._pixiContainer.position.set(e.x,e.y),this._drawCallback(this.utils,i),this._enableLeafletRounding()},_update:function(t){if(!this._map._animatingZoom||!this._bounds){var i=this.options.padding,e=this._map.getSize(),n=this._map.containerPointToLayerPoint(e.multiplyBy(-i)).round();if(this._bounds=new _.Bounds(n,n.add(e.multiplyBy(1+2*i)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom(),this._doubleBuffering){var o=this._renderer;this._renderer=this._auxRenderer,this._auxRenderer=o}var r=this._renderer.view,s=this._bounds,a=this._container,h=s.getSize();if(!this._renderer.size||this._renderer.size.x!==h.x||this._renderer.size.y!==h.y){if(this._renderer.gl&&(this._renderer.resolution=this._renderer.rootRenderTarget.resolution=this.options.resolution),this._renderer.resize(h.x,h.y),r.style.width=h.x+"px",r.style.height=h.y+"px",this._renderer.gl){var d=this._renderer.gl;d.drawingBufferWidth!==this._renderer.width&&(this._renderer.resolution=this._renderer.rootRenderTarget.resolution=this.options.resolution*d.drawingBufferWidth/this._renderer.width,this._renderer.resize(h.x,h.y))}this._renderer.size=h}if(this._doubleBuffering){var l=this;requestAnimationFrame(function(){l._redraw(s.min,t),l._renderer.gl.finish(),r.style.visibility="visible",l._auxRenderer.view.style.visibility="hidden",_.DomUtil.setPosition(a,s.min)})}else this._redraw(s.min,t),_.DomUtil.setPosition(a,s.min)}},_disableLeafletRounding:function(){_.Point.prototype._round=i},_enableLeafletRounding:function(){_.Point.prototype._round=t},_zoomChange:function(){this._scale=this._map.getZoomScale(this._map.getZoom(),this._initialZoom)},redraw:function(t){return this._map&&(this._disableLeafletRounding(),this._drawCallback(this.utils,t),this._enableLeafletRounding()),this}};"1"<=_.version?_.PixiOverlay=_.Layer.extend(n):(_.Map.prototype.getZoomScale=function(t,i){var e=this.options.crs;return i=void 0===i?this._zoom:i,e.scale(t)/e.scale(i)},_.DomUtil.setTransform=function(t,i,e){var n=i||new _.Point(0,0);t.style[_.DomUtil.TRANSFORM]=(_.Browser.ie3d?"translate("+n.x+"px,"+n.y+"px)":"translate3d("+n.x+"px,"+n.y+"px,0)")+(e?" scale("+e+")":"")},n.includes=_.Mixin.Events,n.addTo=function(t){return t.addLayer(this),this},n._setMap=function(t){this._map=t,this._zoomAnimated=t._zoomAnimated},n._setContainerStyle=function(){var i=this;["-webkit-transform-origin","-ms-transform-origin","transform-origin"].forEach(function(t){i._container.style[t]="0 0"})},n._addContainer=function(){this._map.getPanes()[this.options.pane||"overlayPane"].appendChild(this._container)},n._setEvents=function(){var t=this.getEvents();for(var i in t)this._map.on(i,t[i],this)},n.onRemove=function(){this._map.getPanes()[this.options.pane||"overlayPane"].removeChild(this._container);var t=this.getEvents();for(var i in t)this._map.off(i,t[i],this)},_.PixiOverlay=_.Class.extend(n)),_.pixiOverlay=function(t,i,e){return _.Browser.canvas?new _.PixiOverlay(t,i,e):null}});