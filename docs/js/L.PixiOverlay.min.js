!function(t){if("function"==typeof define&&define.amd)define(["leaflet","pixi.js"],t);else if("undefined"!=typeof module)module.exports=t(require("leaflet"),require("pixi.js"));else{if(void 0===window.L)throw new Error("Leaflet must be loaded first");if(void 0===window.PIXI)throw new Error("Pixi.js must be loaded first");t(window.L,window.PIXI)}}(function(t,i){var e=t.Point.prototype._round,n=function(){return this},o={options:{padding:.1,forceCanvas:!1,doubleBuffering:!1,resolution:t.Browser.retina?2:1,projectionZoom:function(t){return(t.getMaxZoom()+t.getMinZoom())/2}},initialize:function(e,n,o){t.setOptions(this,o),t.stamp(this),this._drawCallback=e,this._pixiContainer=n,this._rendererOptions={transparent:!0,resolution:this.options.resolution,antialias:!0,forceCanvas:this.options.forceCanvas},this._doubleBuffering=i.utils.isWebGLSupported()&&!this.options.forceCanvas&&this.options.doubleBuffering},_setMap:function(){},_setContainerStyle:function(){},_addContainer:function(){this.getPane().appendChild(this._container)},_setEvents:function(){},onAdd:function(e){if(this._setMap(e),!this._container){var n=this._container=t.DomUtil.create("div","leaflet-pixi-overlay");this._renderer=i.autoDetectRenderer(this._rendererOptions),n.appendChild(this._renderer.view),this._zoomAnimated&&(t.DomUtil.addClass(n,"leaflet-zoom-animated"),this._setContainerStyle()),this._doubleBuffering&&(this._auxRenderer=i.autoDetectRenderer(this._rendererOptions),n.appendChild(this._auxRenderer.view),this._renderer.view.style.position="absolute",this._auxRenderer.view.style.position="absolute")}this._addContainer(),this._setEvents();var o=this._map;this._initialZoom=this.options.projectionZoom(o),this._wgsOrigin=t.latLng([0,0]),this._wgsInitialShift=o.project(this._wgsOrigin,this._initialZoom),this._mapInitialZoom=o.getZoom(),this._scale=o.getZoomScale(this._mapInitialZoom,this._initialZoom);var r=this;this.utils={latLngToLayerPoint:function(i,e){return e=void 0===e?r._initialZoom:e,o.project(t.latLng(i),e)},layerPointToLatLng:function(i,e){e=void 0===e?r._initialZoom:e;var n=t.point(i);return o.unproject(n,e)},getScale:function(t){return void 0===t?r._scale:o.getZoomScale(t,r._initialZoom)},getRenderer:function(){return r._renderer},getContainer:function(){return r._pixiContainer},getMap:function(){return r._map}},this._update()},onRemove:function(){t.DomUtil.remove(this._container)},getEvents:function(){var t={zoom:this._onZoom,moveend:this._update,zoomend:this._zoomChange};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(i,e){var n=this._map.getZoomScale(e,this._zoom),o=t.DomUtil.getPosition(this._container),r=this._map.getSize().multiplyBy(.5+this.options.padding),s=this._map.project(this._center,e),a=this._map.project(i,e).subtract(s),h=r.multiplyBy(1-n).add(o).subtract(a);t.Browser.any3d?t.DomUtil.setTransform(this._container,h,n):t.DomUtil.setPosition(this._container,h)},_update:function(){if(!this._map._animatingZoom||!this._bounds){var i=this.options.padding,e=this._map.getSize(),n=this._map.containerPointToLayerPoint(e.multiplyBy(-i)).round();if(this._bounds=new t.Bounds(n,n.add(e.multiplyBy(1+2*i)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom(),this._doubleBuffering){var o=this._renderer;this._renderer=this._auxRenderer,this._auxRenderer=o}var r=this._renderer.view,s=this._bounds,a=this._container,h=s.getSize();if(!this._renderer.size||this._renderer.size.x!==h.x||this._renderer.size.y!==h.y){if(this._renderer.gl&&(this._renderer.resolution=this._renderer.rootRenderTarget.resolution=this.options.resolution),this._renderer.resize(h.x,h.y),r.style.width=h.x+"px",r.style.height=h.y+"px",this._renderer.gl){var d=this._renderer.gl;d.drawingBufferWidth!==this._renderer.width&&(this._renderer.resolution=this._renderer.rootRenderTarget.resolution=this.options.resolution*d.drawingBufferWidth/this._renderer.width,this._renderer.resize(h.x,h.y))}this._renderer.size=h}this._disableLeafletRounding();var _=this._map.latLngToLayerPoint(this._wgsOrigin)._subtract(this._wgsInitialShift.multiplyBy(this._scale))._subtract(s.min);this._pixiContainer.scale.set(this._scale),this._pixiContainer.position.set(_.x,_.y),this._drawCallback(this.utils),this._enableLeafletRounding(),this._doubleBuffering&&(this._renderer.gl.flush(),r.style.visibility="visible",this._auxRenderer.view.style.visibility="hidden"),t.DomUtil.setPosition(a,s.min)}},_disableLeafletRounding:function(){t.Point.prototype._round=n},_enableLeafletRounding:function(){t.Point.prototype._round=e},_zoomChange:function(){this._scale=this._map.getZoomScale(this._map.getZoom(),this._initialZoom)},redraw:function(){return this._map&&this._update(),this}};t.version>="1"?t.PixiOverlay=t.Layer.extend(o):(t.Map.prototype.getZoomScale=function(t,i){var e=this.options.crs;return i=void 0===i?this._zoom:i,e.scale(t)/e.scale(i)},t.DomUtil.setTransform=function(i,e,n){var o=e||new t.Point(0,0);i.style[t.DomUtil.TRANSFORM]=(t.Browser.ie3d?"translate("+o.x+"px,"+o.y+"px)":"translate3d("+o.x+"px,"+o.y+"px,0)")+(n?" scale("+n+")":"")},o.includes=t.Mixin.Events,o.addTo=function(t){return t.addLayer(this),this},o._setMap=function(t){this._map=t,this._zoomAnimated=t._zoomAnimated},o._setContainerStyle=function(){var t=this;["-webkit-transform-origin","-ms-transform-origin","transform-origin"].forEach(function(i){t._container.style[i]="0 0"})},o._addContainer=function(){this._map._panes.overlayPane.appendChild(this._container)},o._setEvents=function(){var t=this.getEvents();for(var i in t)this._map.on(i,t[i],this)},t.PixiOverlay=t.Class.extend(o)),t.pixiOverlay=function(i,e,n){return t.Browser.canvas?new t.PixiOverlay(i,e,n):null}});