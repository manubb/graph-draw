!function(i){if("function"==typeof define&&define.amd)define(["leaflet","pixi.js"],i);else if("undefined"!=typeof module)module.exports=i(require("leaflet"),require("pixi.js"));else{if(void 0===window.L)throw new Error("Leaflet must be loaded first");if(void 0===window.PIXI)throw new Error("Pixi.js must be loaded first");i(window.L,window.PIXI)}}(function(i,t){var e=i.Point.prototype._round,n=function(){return this},o={options:{padding:.1,forceCanvas:!1,doubleBuffering:!1,resolution:i.Browser.retina?2:1,projectionZoom:function(i){return(i.getMaxZoom()+i.getMinZoom())/2}},initialize:function(e,n,o){i.setOptions(this,o),i.stamp(this),this._drawCallback=e,this._pixiContainer=n,this._rendererOptions={transparent:!0,resolution:this.options.resolution,antialias:!0,forceCanvas:this.options.forceCanvas},this._doubleBuffering=t.utils.isWebGLSupported()&&!this.options.forceCanvas&&this.options.doubleBuffering},_setMap:function(){},_setContainerStyle:function(){},_addContainer:function(){this.getPane().appendChild(this._container)},_setEvents:function(){},onAdd:function(e){if(this._setMap(e),!this._container){var n=this._container=i.DomUtil.create("div","leaflet-pixi-overlay");this._renderer=t.autoDetectRenderer(this._rendererOptions),n.appendChild(this._renderer.view),this._zoomAnimated&&(i.DomUtil.addClass(n,"leaflet-zoom-animated"),this._setContainerStyle()),this._doubleBuffering&&(this._auxRenderer=t.autoDetectRenderer(this._rendererOptions),n.appendChild(this._auxRenderer.view),this._renderer.view.style.position="absolute",this._auxRenderer.view.style.position="absolute")}this._addContainer(),this._setEvents();var o=this._map;this._initialZoom=this.options.projectionZoom(o),this._wgsOrigin=i.latLng([0,0]),this._wgsInitialShift=o.project(this._wgsOrigin,this._initialZoom),this._mapInitialZoom=o.getZoom(),this._scale=o.getZoomScale(this._mapInitialZoom,this._initialZoom);var r=this;this.utils={latLngToLayerPoint:function(t,e){return e=void 0===e?r._initialZoom:e,o.project(i.latLng(t),e)},layerPointToLatLng:function(t,e){e=void 0===e?r._initialZoom:e;var n=i.point(t);return o.unproject(n,e)},getScale:function(i){return void 0===i?r._scale:o.getZoomScale(i,r._initialZoom)},getRenderer:function(){return r._renderer},getContainer:function(){return r._pixiContainer},getMap:function(){return r._map}},this._update()},onRemove:function(){i.DomUtil.remove(this._container)},getEvents:function(){var i={zoom:this._onZoom,moveend:this._update,zoomend:this._zoomChange};return this._zoomAnimated&&(i.zoomanim=this._onAnimZoom),i},_onAnimZoom:function(i){this._updateTransform(i.center,i.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var n=this._map.getZoomScale(e,this._zoom),o=i.DomUtil.getPosition(this._container),r=this._map.getSize().multiplyBy(.5+this.options.padding),s=this._map.project(this._center,e),a=this._map.project(t,e).subtract(s),h=r.multiplyBy(1-n).add(o).subtract(a);i.Browser.any3d?i.DomUtil.setTransform(this._container,h,n):i.DomUtil.setPosition(this._container,h)},_update:function(t){if(!this._map._animatingZoom||!this._bounds){var e=this.options.padding,n=this._map.getSize(),o=this._map.containerPointToLayerPoint(n.multiplyBy(-e)).round();if(this._bounds=new i.Bounds(o,o.add(n.multiplyBy(1+2*e)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom(),this._doubleBuffering){var r=this._renderer;this._renderer=this._auxRenderer,this._auxRenderer=r}var s=this._renderer.view,a=this._bounds,h=this._container,d=a.getSize();if(!this._renderer.size||this._renderer.size.x!==d.x||this._renderer.size.y!==d.y){if(this._renderer.gl&&(this._renderer.resolution=this._renderer.rootRenderTarget.resolution=this.options.resolution),this._renderer.resize(d.x,d.y),s.style.width=d.x+"px",s.style.height=d.y+"px",this._renderer.gl){var _=this._renderer.gl;_.drawingBufferWidth!==this._renderer.width&&(this._renderer.resolution=this._renderer.rootRenderTarget.resolution=this.options.resolution*_.drawingBufferWidth/this._renderer.width,this._renderer.resize(d.x,d.y))}this._renderer.size=d}this._disableLeafletRounding();var l=this._map.latLngToLayerPoint(this._wgsOrigin)._subtract(this._wgsInitialShift.multiplyBy(this._scale))._subtract(a.min);this._pixiContainer.scale.set(this._scale),this._pixiContainer.position.set(l.x,l.y),this._drawCallback(this.utils),this._enableLeafletRounding(),this._doubleBuffering&&(this._renderer.gl.flush(),s.style.visibility="visible",this._auxRenderer.view.style.visibility="hidden"),i.DomUtil.setPosition(h,a.min)}},_disableLeafletRounding:function(){i.Point.prototype._round=n},_enableLeafletRounding:function(){i.Point.prototype._round=e},_zoomChange:function(){this._scale=this._map.getZoomScale(this._map.getZoom(),this._initialZoom)}};i.version>="1"?i.PixiOverlay=i.Layer.extend(o):(i.Map.prototype.getZoomScale=function(i,t){var e=this.options.crs;return t=void 0===t?this._zoom:t,e.scale(i)/e.scale(t)},i.DomUtil.setTransform=function(t,e,n){var o=e||new i.Point(0,0);t.style[i.DomUtil.TRANSFORM]=(i.Browser.ie3d?"translate("+o.x+"px,"+o.y+"px)":"translate3d("+o.x+"px,"+o.y+"px,0)")+(n?" scale("+n+")":"")},o.includes=i.Mixin.Events,o.addTo=function(i){return i.addLayer(this),this},o._setMap=function(i){this._map=i,this._zoomAnimated=i._zoomAnimated},o._setContainerStyle=function(){var i=this;["-webkit-transform-origin","-ms-transform-origin","transform-origin"].forEach(function(t){i._container.style[t]="0 0"})},o._addContainer=function(){this._map._panes.overlayPane.appendChild(this._container)},o._setEvents=function(){var i=this.getEvents();for(var t in i)this._map.on(t,i[t],this)},i.PixiOverlay=i.Class.extend(o)),i.pixiOverlay=function(t,e,n){return i.Browser.canvas?new i.PixiOverlay(t,e,n):null}});